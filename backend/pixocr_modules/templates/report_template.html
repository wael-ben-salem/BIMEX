<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document Extraction Report</title>
  <style>
    /* Reset and base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      color: #1f2937;
      background: #ffffff;
      font-size: 11pt;
    }

    /* PDF-specific styles */
    @page {
      size: A4;
      margin: 20mm 15mm 25mm 15mm;
      @bottom-center {
        content: element(footer);
        font-size: 9pt;
        color: #6b7280;
      }
    }

    /* Footer styling */
    .footer {
      position: running(footer);
      width: 100%;
      text-align: center;
      border-top: 1px solid #e5e7eb;
      padding-top: 8px;
      font-size: 9pt;
      color: #6b7280;
      background: #ffffff;
    }

    .footer-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 100%;
    }

    .footer-left {
      text-align: left;
      flex: 1;
    }

    .footer-center {
      text-align: center;
      flex: 1;
    }

    .footer-right {
      text-align: right;
      flex: 1;
    }

    /* Typography */
    h1 {
      font-size: 24pt;
      font-weight: 700;
      color: #1e40af;
      margin-bottom: 32px;
      border-bottom: 3px solid #2563eb;
      padding-bottom: 12px;
      letter-spacing: -0.025em;
    }

    h2 {
      font-size: 16pt;
      font-weight: 600;
      color: #1e3a8a;
      margin-top: 32px;
      margin-bottom: 16px;
      padding-left: 12px;
      border-left: 4px solid #3b82f6;
      background: linear-gradient(90deg, #eff6ff 0%, #ffffff 100%);
      padding-top: 8px;
      padding-bottom: 8px;
    }

    /* Section styling */
    .section {
      margin-bottom: 40px;
      page-break-inside: avoid;
    }

    .section:last-child {
      margin-bottom: 20px;
    }

    /* Image styling */
    img {
      max-width: 100%;
      height: auto;
      margin: 16px 0;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      page-break-inside: avoid;
    }

    /* Table styling */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 10pt;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      page-break-inside: avoid;
    }

    th {
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
 
      color: #1e293b;
      font-weight: 600;
      padding: 12px 10px;
      text-align: left;
      border: 1px solid #1d4ed8;
      font-size: 10pt;
    }

    td {
      padding: 10px;
      border: 1px solid #d1d5db;
      vertical-align: top;
    }

    tbody tr:nth-child(even) {
      background-color: #f9fafb;
    }

    tbody tr:hover {
      background-color: #f3f4f6;
    }

    /* List styling */
    ul {
      list-style: none;
      padding-left: 0;
    }

    li {
      margin-bottom: 8px;
      padding: 8px 12px;
      background: #f8fafc;
      border-left: 3px solid #0891b2;
      border-radius: 0 4px 4px 0;
    }

    li strong {
      color: #0f172a;
      font-weight: 600;
    }

    /* Code and pre styling */
    pre {
      background: #f1f5f9;
      border: 1px solid #cbd5e1;
      border-radius: 6px;
      padding: 16px;
      margin: 16px 0;
      font-family: 'Courier New', Consolas, 'Liberation Mono', monospace;
      font-size: 9pt;
      line-height: 1.4;
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: break-word;
      page-break-inside: avoid;
    }

    code {
      font-family: 'Courier New', Consolas, 'Liberation Mono', monospace;
      font-size: 9pt;
      background: #f1f5f9;
      padding: 2px 4px;
      border-radius: 3px;
      color: #1e293b;
    }

    /* Warning and info text */
    .no-content {
      color: #6b7280;
      font-style: italic;
      padding: 16px;
      background: #f9fafb;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
    }

    /* Special styling for LLM review */
    .llm-review {
      background: #fefce8;
      border: 1px solid #fde047;
      border-radius: 8px;
      padding: 20px;
      margin: 16px 0;
      font-family: 'Courier New', Consolas, 'Liberation Mono', monospace;
      font-size: 10pt;
      line-height: 1.5;
      white-space: pre-wrap;
      word-wrap: break-word;
      page-break-inside: avoid;
    }

    /* Page break utilities */
    .page-break-before {
      page-break-before: always;
    }

    .page-break-after {
      page-break-after: always;
    }

    /* Utility classes */
    .text-center { text-align: center; }
    .text-small { font-size: 9pt; }
    .text-muted { color: #6b7280; }
    .mb-large { margin-bottom: 32px; }

    /* Header icons styling */
    h2::before {
      display: inline-block;
      margin-right: 8px;
      font-size: 14pt;
    }
  </style>
</head>
<body>
  <!-- Footer content (positioned via CSS) -->
  <div class="footer">
    <div class="footer-content">
      <div class="footer-left">
        Generated: {{ timestamp }}
      </div>
      <div class="footer-center">
        Model: {{ model_name }}
      </div>
      <div class="footer-right">
        Version: {{ version }}
      </div>
    </div>
  </div>

  <!-- Main content -->
  <h1>üìÑ Document Extraction Report</h1>

  <div class="section">
    <h2>üñºÔ∏è Original Document</h2>
    {% if image_url %}
      <div class="text-center">
        <img src="{{ image_url }}" alt="Original Document">
      </div>
    {% else %}
      <p class="no-content">No document image available.</p>
    {% endif %}
  </div>

  <div class="section">
    <h2>üìã Header Information</h2>
    {% if header %}
      <ul>
      {% for key, value in header.items() %}
        {% if key != "Raw_OCR_Text" %}
          <li><strong>{{ key }}:</strong> {{ value }}</li>
        {% endif %}
      {% endfor %}
      </ul>
      {% if header.Raw_OCR_Text %}
        <h3 style="margin-top: 24px; margin-bottom: 12px; color: #374151; font-size: 13pt;">Raw OCR Text:</h3>
        <pre><code>{{ header.Raw_OCR_Text }}</code></pre>
      {% endif %}
    {% else %}
      <p class="no-content">No header information available.</p>
    {% endif %}
  </div>

  <div class="section">
    <h2>üìä Extracted Table(s)</h2>
    {% if tables and tables|length > 0 %}
      {% for table in tables %}
        {% if loop.index > 1 %}
          <h3 style="margin-top: 32px; margin-bottom: 16px; color: #374151; font-size: 13pt;">Table {{ loop.index }}</h3>
        {% endif %}
        
        {% if table.headers and table.headers|length > 0 %}
          <table>
            <thead>
              <tr>
                {% for header in table.headers %}
                  <th>{{ header if header else 'Column ' + loop.index|string }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in table.rows %}
                <tr>
                  {% for cell in row %}
                    <td>{{ cell if cell else '‚Äî' }}</td>
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p class="no-content">Table structure not available.</p>
        {% endif %}
      {% endfor %}
    {% else %}
      <p class="no-content">No tables found in the document.</p>
    {% endif %}
  </div>

  <div class="section">
    <h2>‚ö†Ô∏è Warnings</h2>
    {% if warnings and warnings|length > 0 %}
      <ul>
        {% for warning in warnings %}
          <li>
            <strong>Warning:</strong> 
            {{ warning.message if warning.message else warning.header_warning if warning.header_warning else 'Unspecified warning' }}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="no-content">No warnings found.</p>
    {% endif %}
  </div>

  <div class="section page-break-before">
    <h2>ü§ñ LLM Review Summary</h2>
    {% if llm_review %}
      <div class="llm-review">{{ llm_review }}</div>
    {% else %}
      <p class="no-content">No LLM review available.</p>
    {% endif %}
  </div>

    <!-- Validation Summary (moved here) -->
  <div class="section page-break-before">
    {{ validation_summary_html | safe }}
  </div>


  <div class="section page-break-before">
    <h2>üßæ Full Text (OCR)</h2>
    {% if full_text %}
      <pre><code>{{ full_text }}</code></pre>
    {% else %}
      <p class="no-content">No OCR text available.</p>
    {% endif %}
  </div>

</body>
</html>